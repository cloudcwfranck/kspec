apiVersion: kspec.io/v1alpha1
kind: ClusterTarget
metadata:
  name: staging-cluster
  namespace: kspec-system
spec:
  # Kubernetes API server endpoint
  apiServerURL: https://staging.k8s.example.com:6443

  # Authentication mode: serviceAccount
  authMode: serviceAccount

  # Reference to Secret containing ServiceAccount token
  serviceAccountSecretRef:
    name: staging-cluster-token
    namespace: kspec-system
    key: token  # Optional: defaults to "token"

  # CA certificate for cluster
  # Extract from: kubectl get secret <sa-secret> -o jsonpath='{.data.ca\.crt}'
  caData: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJZHRMYlNoc...

  # Enable enforcement on this cluster
  allowEnforcement: true

  # Scan this cluster every 5 minutes
  scanInterval: 5m
---
# Example Secret containing ServiceAccount token
# To create this token on the remote cluster:
# 1. kubectl create serviceaccount kspec-scanner -n kspec-system
# 2. kubectl create clusterrolebinding kspec-scanner --clusterrole=kspec-scanner --serviceaccount=kspec-system:kspec-scanner
# 3. kubectl create token kspec-scanner -n kspec-system --duration=8760h  # 1 year
apiVersion: v1
kind: Secret
metadata:
  name: staging-cluster-token
  namespace: kspec-system
type: Opaque
stringData:
  token: eyJhbGciOiJSUzI1NiIsImtpZCI6IktMYjNaOVd...
