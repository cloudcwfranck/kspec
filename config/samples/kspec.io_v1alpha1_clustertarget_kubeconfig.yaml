apiVersion: kspec.io/v1alpha1
kind: ClusterTarget
metadata:
  name: prod-us-east-1
  namespace: kspec-system
spec:
  # Kubernetes API server endpoint
  apiServerURL: https://prod-k8s-us-east-1.example.com:6443

  # Authentication mode: kubeconfig, serviceAccount, or token
  authMode: kubeconfig

  # Reference to Secret containing kubeconfig file
  kubeconfigSecretRef:
    name: prod-us-east-1-kubeconfig
    namespace: kspec-system
    key: kubeconfig  # Optional: defaults to "kubeconfig"

  # Optional: PEM-encoded CA certificate
  # caData: LS0tLS1CRUdJTi...

  # Optional: Skip TLS verification (not recommended for production)
  insecureSkipTLSVerify: false

  # Optional: Enable policy enforcement and drift remediation on this cluster
  # If false (default), the cluster will be scanned read-only
  allowEnforcement: false

  # Optional: Custom scan interval (defaults to operator's reconciliation interval)
  # scanInterval: 10m
---
# Example Secret containing kubeconfig
apiVersion: v1
kind: Secret
metadata:
  name: prod-us-east-1-kubeconfig
  namespace: kspec-system
type: Opaque
stringData:
  kubeconfig: |
    apiVersion: v1
    kind: Config
    clusters:
      - name: prod-cluster
        cluster:
          server: https://prod-k8s-us-east-1.example.com:6443
          certificate-authority-data: LS0tLS1CRUdJTi0tLS0t...  # Base64 CA cert
    users:
      - name: kspec-scanner
        user:
          token: eyJhbGciOiJSUzI1NiIsImtpZCI...  # ServiceAccount token from remote cluster
    contexts:
      - name: prod-context
        context:
          cluster: prod-cluster
          user: kspec-scanner
    current-context: prod-context
